{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<!-- Header-->
<header class="bg-dark py-5">
    <div class="container px-4 px-lg-5 my-5">
        <div class="text-center text-white">
            <h1 class="display-4 fw-bolder">Billing Infomation</h1>
            <p class="lead fw-normal text-white-50 mb-0">Review your billing information...</p>
        </div>
    </div>
</header>
<br>
<div class="container-fluid cart-container mb-5 mx-auto" style="width: 50%;">
    <div class="card">
        <div class="card-body px-5">
            <p class="fs-4 fw-semibold mb-3">Order Details</p>
            <hr>
            <div class="d-flex justify-content-between pb-2" style="font-size: 18px">
                <p class="fw-semibold mb-0">PRODUCT</p>
                <p class="fw-semibold mb-0">TOTAL</p>
            </div>
            <div style="height: 5px; width: 100%; background: #eee" class="mb-3"></div>
            <div style="font-size: 15px">
                {% for product in cart_products %}
                <div class="d-flex justify-content-between">
                    <div class="left">
                        <span class="fw-semibold">
                            {{ product.name }} <strong>
                                <i class="bi bi-x"></i>
                                {% for key, value in quantities.items %}
                                {% if key == product.id|slugify %}
                                {{ value }}
                                {% endif %}
                                {% endfor %}</strong></span>
                    </div>
                    <div class="right">
                        {% if product.is_sale %}
                        {{ product.sale_price|floatformat:0|intcomma }}đ
                        {% else %}
                        {{ product.price|floatformat:0|intcomma }}đ
                        {% endif %}
                    </div>
                </div>
                <hr>
                {% endfor %}
            </div>

            <div class="d-flex justify-content-between">
                <strong>
                    <p class="mb-0">SubTotal:</p>
                </strong>
                <p data-title="Total" class="order-total-content mb-0">
                    <span class="woocommerce-Price-amount amount">
                        <span class="currencySymbol"></span>{{ totals|floatformat:0|intcomma }}đ
                    </span>
                </p>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
                <span><strong>Shipping: </strong><small>&#40;via {{ shipping_method }} Delivery&#41;</small></span>
                <span class="woocommerce-Price-amount amount"><bdi>{{ price_ship|intcomma}}đ</bdi></span>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
                <strong>
                    <p class="mb-0">Total:</p>
                </strong>
                <p data-title="Total" class="order-total-content mb-0">
                    <span class="woocommerce-Price-amount amount">
                        <span class="currencySymbol"></span>{{ total_final|floatformat:0|intcomma }}đ
                    </span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="card mb-5 mx-auto" style="width: 48%;">
    <div class="card-body">
        <p class="fs-4 fw-bold mb-3">Shipping Info</p>
        <span class="mb-2">Full Name: </span>
        {{ shipping_info.shipping_full_name }}
        <br>
        <span class="mb-2">Phone: </span>
        {{ shipping_info.shipping_phone }}
        <br>
        <span class="mb-2">Address: </span>
        {{ shipping_info.shipping_address }}
        <br>
        <span class="mb-2">State: </span>
        {{ shipping_info.shipping_state }}
        <br>
    </div>
</div>


<div class="d-md-flex align-items-center mx-auto mb-3" style="width: 48%;">
    <div class="card-body box2 shadow-sm mx-auto">
        <p class="fs-4 fw-bold mb-3 ps-2">Payment method</p>
        <ul class="nav nav-tabs mb-3 px-md-4 px-2" id="paymentTabs">
            <li class="nav-item" onclick="selectPaymentMethod('credit')">
                <label class="form-check-label" for="credit">
                    <a class="nav-link" id="creditCardTab" data-bs-toggle="tab" href="#creditCard">
                        <input class="form-check-input" type="radio" name="payment_method" id="credit" value="creditCard">
                        <i class="fa fa-credit-card me-2"></i> Credit Card
                    </a>
                </label>
            </li>
            <li class="nav-item" onclick="selectPaymentMethod('paypalMethod')">
                <label class="form-check-label" for="paypalMethod">
                    <a class="nav-link" id="paypalTab" data-bs-toggle="tab" href="#paypal">
                        <input class="form-check-input" type="radio" name="payment_method" id="paypalMethod" value="paypal">
                        <i class="fab fa-paypal me-2"></i> Paypal
                    </a>
                </label>
            </li>
            <li class="nav-item" onclick="selectPaymentMethod('upon')">
                <label class="form-check-label" for="upon">
                    <a class="nav-link active" id="uponReceiptTab" data-bs-toggle="tab" href="#uponReceipt">
                        <input class="form-check-input" type="radio" name="payment_method" id="upon" value="uponReceipt" checked>
                        <i class="fa fa-truck me-2"></i> Upon Receipt
                    </a>
                </label>
            </li>
        </ul>
        
        <div style="width: 95%" class="mx-auto">
            <div class="tab-content">
                <!-- Credit Card Form -->

                <div class="tab-pane fade" id="creditCard">
                    <form action="{% url 'process_order' %}" method="post">
                    {% csrf_token %}
                    <div class="card mb-3 mx-auto border-0">
                        <div class="card-body">
                            <p class="fs-4 fw-bold mb-3">Card Info</p>
                            <!-- Cardholder's Name -->
                            <div class="mb-3">
                                {{ billing_form.card_name }}
                            </div>
                            
                            <!-- Card Number -->
                            <div class="mb-3">
                                {{ billing_form.card_number }}
                            </div>
                            
                            <!-- Expiration Date and CVV (on the same row) -->
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="input-group">
                                        {{ billing_form.card_exp_date }}
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="input-group">
                                        {{ billing_form.card_cvv_number }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Billing Address -->
                            <div class="mb-3">
                                {{ billing_form.card_address }}
                            </div>
                            
                            <!-- ZIP Code -->
                            <div class="mb-3">
                                {{ billing_form.card_zipcode }}
                            </div>
                        </div>
                    </div>
                    <div class="card mb-5 mx-auto" style="border: none">
                        <button type="submit" class="btn btn-outline-primary mx-auto rounded-pill" style="width: 48%">Pay now</button>
                    </div>
                    </form>
                </div>

                <!-- Paypal Form -->
                <div class="tab-pane fade" id="paypal">
                    <form action="{% url 'process_order_paypal' %}" method="post">
                    {% csrf_token %}
                    <div class="card mb-3 mx-auto" style="border: 2px solid #007bff;">
                        <div class="card-body">
                            <p class="fs-4 fw-bold mb-3">Paypal Payment</p>
                            <!-- Thêm thông tin thanh toán PayPal ở đây -->
                            <p>Enter your PayPal information here.</p>
                        </div>
                    </div>
                    <div class="card mb-5 mx-auto" style="border: none">
                        <button type="submit" class="btn btn-outline-primary mx-auto rounded-pill" style="width: 48%">Pay now</button>
                    </div>
                    </form>
                </div>

                <!-- Upon Receipt Form -->
                <div class="tab-pane fade  show active" id="uponReceipt">
                    <form action="{% url 'process_order_upon' %}" method="post">
                    {% csrf_token %}
                    <div class="card mb-3 mx-auto" style="border: 2px solid #007bff;">
                        <div class="card-body">
                            <p class="fs-4 fw-bold mb-3">Payment Upon Receipt</p>
                            <!-- Thêm thông tin thanh toán khi nhận hàng ở đây -->
                            <p>Choose this option if you prefer to pay upon receiving the goods.</p>
                        </div>
                    </div>
                    <div class="card mb-5 mx-auto" style="border: none">
                        <button type="submit" class="btn btn-outline-primary mx-auto rounded-pill" style="width: 48%">Pay now</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function selectPaymentMethod(id) {
        // Chọn radio button dựa vào ID được truyền vào
        const radio = document.getElementById(id);
        if (radio) {
            radio.checked = true; // Đánh dấu radio được chọn
        }

        // Đồng thời kích hoạt tab tương ứng nếu cần
        const targetTab = document.querySelector(`a[href="#${radio.value}"]`);
        if (targetTab) {
            const bootstrapTab = new bootstrap.Tab(targetTab);
            bootstrapTab.show();
        }
    }
</script>
{% endblock %}